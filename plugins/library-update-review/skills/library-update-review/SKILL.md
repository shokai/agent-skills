---
name: library-update-review
description: >-
  ライブラリ更新pull requestのレビュー。
  dependabotやrenovatebotが作成したPR、または手動で作成されたライブラリ更新PRをレビューし、
  release note分析、コード更新、依存関係調査、過去の失敗調査を行う。
argument-hint: "[PR-URL-or-number]"
---

# ライブラリ更新のレビュー手順書

ライブラリを更新する変更をレビューし、必要に応じてバージョン間のmigrationや、breaking changeへの対応も行う為の手順を説明します。

## 対象

- dependabotやrenovatebotが作成したライブラリ更新pull request
- 人間が作成したライブラリ更新pull request

## 章立てと実行すべき作業

以下に示した形式に従って章立てし、レポートを作成してください。
外部のドキュメントを参照した場合はそのURLを明記してください。

### 1. ライブラリの概要

ライブラリの概要を調査してください。
ライブラリ内READMEや公式サイトのドキュメントを確認して、何を実現するために、どのような用途で使われるライブラリなのかを報告してください。

### 2. バージョン情報

package.jsonを読んで、このpull requestによって変更される前と後のバージョン情報と、それぞれのリリース日時を報告してください。

npmjs.comやgithubを調査し、major versionの更新の有無を報告してください。
このpull requestではpatch versionやminor versionを更新しているが、実はそれが最新版ではなく、major versionの更新があるかもしれません。
major version更新ではライブラリの名前が変更されたり、リポジトリがorganizationに移管されたりする事があります。

### 3. ライブラリの依存関係

ライブラリの依存関係を確認してください。
package-lock.jsonを読んで依存関係を確認してください。`grep -C15 ライブラリ名 package-lock.json` のようなコマンドが有効です。

- そのライブラリに依存している他のライブラリがあれば列挙する
- そのライブラリが依存している他のライブラリがあれば列挙する

### 4. ライブラリ使用箇所

ライブラリ使用箇所を調査してください。
リポジトリ内のimport文やrequire文を `git grep ライブラリ名` で探して、ファイルパスのリストを作成してください。

### 5. 変更内容の要約

変更内容を要約してください。
ライブラリの公式サイトやGithubを参照し、release noteやchangelog、migration guideを詳しく読んで変更内容を把握してください。
機能追加やAPIの仕様変更のうち、特にアプリケーション側で使っている機能に関係がありそうな変更を抜き出して、報告してください。
変更前と後の間に含まれる、全バージョンの変更内容を1つずつ確認する必要があります。

重要：pull requestの概要欄に書かれている説明は誤っている可能性があるので、無視してください。現状のコードとdiffだけを参考にしてください。

### 6. コードの更新

ライブラリのAPIが変化した場合は、アプリケーションのコードを変更する必要があります。
必要に応じてpull requestを作成してください。

release noteやchangelogだけで正しい変更方法がわからない場合は、githubのcommits内の実際の変更差分や、公式ドキュメントも確認してください。
その変更内容も報告してください。

### 7. 興味深い更新

興味深い更新があれば、報告してください。
例えば以下のような内容です：

- アプリケーションにも応用できそうな新機能の実装や概念の発明
- プログラム言語や実行環境の新機能を活用した面白い機能の実装
- ライブラリの開発体制の変化

### 8. 過去の失敗の調査

このリポジトリにおいて、今回更新しようとしているライブラリに関する問題が発生した事がないか、調査してください。
pull requestとissueをライブラリ名で検索し、以下の例に当てはまるような事例があれば報告してください。

- pull requestをmergeせずにcloseした
- mergeしたが、不具合が発生してrevertした

問題が見つかった場合は、それが解決されているか確認してください。

## 最終確認

レポートの形式を見直してください。出力先がGithubのコメント欄の場合は、それに適した形式で出力してください。

## Tips: Githubのコメント欄に適した形式

### 外部リポジトリのissue番号やpull request番号は、完全なURL形式で記載する

#12345 ではなく https://github.com/:owner/:repo/issues/12345 と書く。
URLが左右の文字とくっつかないように、半角スペースを適宜付ける。こうすればクリッカブルなリンクとしてwebブラウザ上に描画される。

## 権限が不足している場合は報告する

あなたがGitHub Actions上で実行されているClaude Codeの場合、タスクを遂行するための権限が十分与えられていないかもしれません。
リポジトリの管理者が適切に対応するために、必要な権限を報告してください。

- 実行しようとしていたタスクの内容
- 不足していた権限。例えば
  - Claude CodeのallowedTools
  - Github Actionsのjobのpermissions
